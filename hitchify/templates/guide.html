{% extends "base_generic.html" %}

{% block content %}
    <div id='bc' class="sub-container">
        <div class="sub-container-title">Guide: <span id="guide_title">{{ guide.title }}</span></div>

        {% if perms.hitchify.change_guide or guide.user_id == user.id %}
            <div>
                <a href="#" class="changelink" onclick="edit(); return false;">Edit</a>
            </div>
        {% endif %}

        <div>
            <a href="#" onclick="printGuide()">üñ®Ô∏è Print</a>
        </div>

        {% if not user.is_staff %}
            <div>
                <a href="#" onclick="suggest(); return false;">üó£ Suggest a change</a>
            </div>
        {% endif %}

        {% if user.is_staff %}
            <div>
                <a href="#" onclick="location.href='{% url 'see_suggestions' guide.id %}'">üéß Check suggestions</a>
            </div>
        {% endif %}

        {# TODO VISUAL PART #}
        {% for tc in guide.top_contributors %}
            {{ tc }}
        {% endfor %}

        <div class="properties-holder">
            {#        <div class="property">#}
            {#            <div class="property-name"><span class="property-icon">üîñ</span>Title</div>#}
            {#            <div id="title" contenteditable="true" spellcheck="false" class="property-value text-property"></div>#}
            {#        </div>#}

            <div class="property">
                <div class="property-name"><span class="property-icon">üìÜ</span>Creation Date</div>
                <div id="created" class="property-value">{{ guide.creation_date }}</div>
            </div>

            <div class="property">
                <div class="property-name"><span class="property-icon">üìÜ</span>Last Update Date</div>
                <div id="updated" class="property-value">{{ guide.update_date }}</div>
            </div>

            <div class="ticket-content-holder">
                <span spellcheck="false" contenteditable="true" id="short_summary"
                      class="highlight">{{ guide.short_summary }}</span>
            </div>

            <div class="ticket-content-holder">
                <span spellcheck="false" contenteditable="true" id="body_text"
                      class="highlight">{{ guide.body_text }}</span>
            </div>

            {#        <button class=" button-style" style="margin-top: 10px;" id="save">Save</button>#}

        </div>

    </div>

    <div id="dialog" style="display: none">
    </div>

    <div id="dialog_c" style="display: none">
    </div>

    <div id="dialog_g" style="display: none">
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
    <script>

        let form_suggestion = '<form action="/guide/{{ guide.id }}/add_suggestion" method="post">' +
            '{% csrf_token %}' +
            'Title:<br>' +
            '<input id="suggestion_title" name="suggestion_title">' +
            '<br>Suggestion text:<br>' +
            '<textarea id="suggestion_text" name="suggestion_text" style="width:400px; height:100px"></textarea>' +
            '<br>' +
            '<button type="submit" class="button-style">Submit</button>' +
            '</form>';

        function suggest() {
            $('#dialog_c').prop('title', 'Add suggestion');
            $('#dialog_c').html(form_suggestion);

            $('#suggestion_title').val('');
            $('#suggestion_text').val('');

            $("#dialog_c").dialog({
                width: 550,
                modal: true,
                position: {my: "center", at: "top+300", of: window}
            });
        }

        function printGuide() {
            window.print()
        }

        let form_post = '<form action="/guide/{{ guide.id }}/edit" method="post">' +
            '{% csrf_token %}' +
            'Title:<br>' +
            '<input id="edit_title" name="title">' +
            '<br>Short summary:<br>' +
            '<textarea id="edit_short_summary" name="short_summary" style="width:400px; height:100px"></textarea>' +
            '<br>Text:<br>' +
            '<textarea id="edit_body_text" name="body_text" style="width:400px; height:300px"></textarea>' +
            '<br>' +
            '<button type="submit" class="button-style">Edit</button>' +
            '</form>';

        function edit() {
            $('#dialog').prop('title', 'Edit guide');
            $('#dialog').html(form_post);

            $('#edit_title').val($('#guide_title').html());
            $('#edit_body_text').val($('#body_text').html());
            $('#edit_short_summary').val($('#short_summary').html());


            $("#dialog").dialog({
                width: 550,
                modal: true,
                position: {my: "center", at: "top+450", of: window}
            });
        }
    </script>

{% endblock %}
